<head>
<% title 'Rideshare' %>
<% description 'Coordinate rides with other festival goers. Sharing a ride creates friendships and helps the enviroment at the same time.' %>
<%= yield :head %>
<%= javascript_include_tag "application" %>
<%= stylesheet_link_tag 'application' %>
<style>
.map_container{
  position: absolute;
  border: none;
  padding: 0px;
  width: 100%;
  height: 100%;
  top: 0px;
  left: 0px;
}
.gmaps4rails_map{
  width: 100%;
  height: 100%;
}
</style>
</head>
<%= link_to image_tag('MFN_Banner.png', class: 'iframe-banner'), root_path %>

<div id="user_login_box">
  <%= form_for("user", :url => user_session_path, :html => {:id => "sign_in"}, :remote => true, :format => :json) do |f| %>
    <%= f.text_field :login %>
    <%= f.password_field :password %>
    <%= f.submit 'Sign in' %>
    <%= link_to "Forgot your password?", new_password_path('user') %>
  <% end %>
</div>




<div class="loader">
</div>

<div class='row-fluid'>
  
    <%= gmaps("map_options" => { :raw => "{scrollwheel: true, mapTypeControl: false}"}, "markers" => {"data" => [], "options" => { 'randomize'=>true, 'max_random_distance'=>30  } }, :last_map => false ) %> 

  
  
</div>

<% @event.rides.each do |ride| %>
  <%= render 'rides/ride_modal', ride:ride %>
<%end%>
<script type="text/javascript" charset="utf-8">
$(function() {
 
//hide the empty container
$(".map_container").hide();

 
  $.getJSON('/iframe_get_events_rideshare/'+<%=params[:festival]%>+'/'+<%=params[:year]%>+'/'+<%=params[:event]%>, function(json){
    $(".map_container").show();
    $('.loader').hide();
    Gmaps.loadMaps();
    Gmaps.map.addMarkers(json);
  })


 
});
</script>

<% content_for :scripts do %>
  <script type="text/javascript">
    
    Gmaps.map.callback = function() {



      $.getJSON('/iframe_rides_gmap/'+<%=params[:festival]%>+'/'+<%=params[:year]%>+'/'+<%=params[:event]%>, function(data){
          Gmaps.map.addMarkers(data);
        });

    
    }
  </script>
<%end%>

<%= yield :scripts %> 

